var dbPromise;class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants/"}static openDatabase(){return idb.open("Restaurant Reviews",4,e=>{switch(e.oldVersion){case 0:e.createObjectStore("restaurants",{keyPath:"id"});case 1:e.createObjectStore("restaurant-reviews",{keyPath:"id"});case 2:e.createObjectStore("outbox",{autoIncrement:!0,keyPath:"id"})}})}static getCachedMessages(){return(dbPromise=DBHelper.openDatabase()).then(function(e){if(e)return e.transaction("restaurants").objectStore("restaurants").getAll()})}static fetchRestaurants(e){DBHelper.getCachedMessages().then(function(t){if(t.length>0)return e(null,t);fetch(DBHelper.DATABASE_URL,{credentials:"same-origin"}).then(e=>(console.log("res fetched is: ",e),e.json())).then(t=>(dbPromise.then(function(e){if(!e)return e;console.log("data fetched is: ",t);var a=e.transaction("restaurants","readwrite").objectStore("restaurants");t.forEach(e=>a.put(e)),a.openCursor(null,"prev").then(function(e){return e.advance(30)}).then(function e(t){if(t)return t.delete(),t.continue().then(e)})}),e(null,t))).catch(t=>e(t,null))})}static fetchRestaurantById(e,t){fetch(`${DBHelper.DATABASE_URL}${e}`).then(e=>{if(e)return e.json()}).then(e=>t(null,e)).catch(e=>t(`Request failed. Returned status of ${e.code}. ${e.message}`,null))}static fetchRestaurantByCuisine(e,t){DBHelper.fetchRestaurants((a,n)=>{if(a)t(a,null);else{const a=n.filter(t=>t.cuisine_type==e);t(null,a)}})}static fetchRestaurantByNeighborhood(e,t){DBHelper.fetchRestaurants((a,n)=>{if(a)t(a,null);else{const a=n.filter(t=>t.neighborhood==e);t(null,a)}})}static fetchRestaurantByCuisineAndNeighborhood(e,t,a){DBHelper.fetchRestaurants((n,r)=>{if(n)a(n,null);else{let n=r;"all"!=e&&(n=n.filter(t=>t.cuisine_type==e)),"all"!=t&&(n=n.filter(e=>e.neighborhood==t)),a(null,n)}})}static fetchNeighborhoods(e){DBHelper.fetchRestaurants((t,a)=>{if(t)e(t,null);else{const t=a.map((e,t)=>a[t].neighborhood),n=t.filter((e,a)=>t.indexOf(e)==a);e(null,n)}})}static fetchCuisines(e){DBHelper.fetchRestaurants((t,a)=>{if(t)e(t,null);else{const t=a.map((e,t)=>a[t].cuisine_type),n=t.filter((e,a)=>t.indexOf(e)==a);e(null,n)}})}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){return void 0===e.photograph?"http://via.placeholder.com/800x600":`/img/${e.photograph}.jpg`}static mapMarkerForRestaurant(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:DBHelper.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}static fetchReviewsForRestaurant(e,t){fetch("http://localhost:1337/reviews/?restaurant_id="+e).then(e=>{200===e.status?e.json().then(e=>{t(null,e)}).catch(e=>{t(e,null)}):t(`Request failed. Returned status of ${e.status}`,null)}).catch(e=>{t(e,null)})}}